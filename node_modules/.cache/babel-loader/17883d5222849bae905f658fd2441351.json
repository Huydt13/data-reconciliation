{"ast":null,"code":"var _jsxFileName = \"H:\\\\BAKCO\\\\pj\\\\cds\\\\src\\\\medical-test\\\\components\\\\assigns\\\\AnonymousAssignTable.js\";\n/* eslint-disable no-nested-ternary */\nimport React, { useState, useEffect, useRef } from 'react';\nimport _ from 'lodash';\nimport {\n// FiAlertTriangle,\nFiFileText, FiUploadCloud } from 'react-icons/fi';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { assignWithCodeOnly, getAssignees, importInformation } from 'medical-test/actions/medical-test';\nimport { useAuth } from 'app/hooks';\nimport { showInfoModal } from 'app/actions/global';\nimport { DataTable } from 'app/components/shared';\nimport { SourceType } from 'infection-chain/utils/constants';\nimport AnonymousAssignFilter from './AnonymousAssignFilter';\nimport AssignWithCodeOnlyModal from '../subjects/AssignWithCodeOnlyModal';\nconst columns = [{\n  Header: '#',\n  accessor: 'index'\n}, {\n  Header: 'Mã xét nghiệm',\n  formatter: _ref => {\n    let {\n      code\n    } = _ref;\n    return (code === null || code === void 0 ? void 0 : code.length) === 12 ? /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 29,\n        columnNumber: 53\n      }\n    }, code) : code;\n  }\n}, {\n  Header: 'Tên cơ sở',\n  formatter: row => row.unit.name\n}];\nconst AnonymousAssignTable = () => {\n  const [filter, setFilter] = useState({});\n  const [pageIndex, setPageIndex] = useState(0);\n  const [pageSize, setPageSize] = useState(10);\n  const {\n    assigneeList,\n    cancelAssignLoading,\n    getAssigneesLoading,\n    assignWithCodeOnlyLoading,\n    importInformationLoading\n  } = useSelector(state => state.medicalTest);\n  const {\n    isAdmin\n  } = useAuth();\n  const dispatch = useDispatch();\n  const handleRefresh = () => {\n    if ((!isAdmin && filter.unitId || isAdmin) && !_.isEmpty(filter)) {\n      dispatch(getAssignees({\n        ...filter,\n        isUnknown: true,\n        pageIndex,\n        pageSize\n      }));\n    }\n  };\n  useEffect(() => {\n    handleRefresh();\n    // eslint-disable-next-line\n  }, [filter, pageIndex, pageSize]);\n  const {\n    data,\n    pageCount\n  } = assigneeList;\n  const [assignWithCodeOnlyModal, setAssignWithCodeOnlyModal] = useState(false);\n  const handleAssignWithCodeOnly = async d => {\n    await dispatch(assignWithCodeOnly(d));\n    handleRefresh();\n    setAssignWithCodeOnlyModal(false);\n  };\n  const fileInputRef = useRef();\n  const [selectedFile, setSelectedFile] = useState(null);\n  useEffect(() => {\n    if (selectedFile) {\n      const formData = new FormData();\n      formData.append('file', selectedFile);\n      dispatch(importInformation(formData)).then(_ref2 => {\n        let {\n          completed,\n          failed\n        } = _ref2;\n        dispatch(showInfoModal(`Thành công: ${completed}`, failed, () => {}));\n        setSelectedFile(null);\n        handleRefresh();\n      });\n    }\n    // eslint-disable-next-line\n  }, [dispatch, selectedFile]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AnonymousAssignFilter, {\n    onChange: setFilter,\n    onRefresh: handleRefresh,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(DataTable, {\n    title: \"Danh s\\xE1ch m\\u1EABu ch\\u01B0a x\\xE1c \\u0111\\u1ECBnh\",\n    columns: columns,\n    data: (data || []).map((r, i) => ({\n      ...r,\n      index: i + 1\n    })),\n    loading: getAssigneesLoading || cancelAssignLoading || assignWithCodeOnlyLoading || importInformationLoading,\n    pageCount: pageCount,\n    onPaginationChange: p => {\n      setPageIndex(p.pageIndex);\n      setPageSize(p.pageSize);\n    },\n    actions: [\n    // {\n    //   icon: <FiAlertTriangle />,\n    //   title: 'Tạo khấn cấp',\n    //   color: 'orange',\n    //   onClick: () => setAssignWithCodeOnlyModal(true),\n    //   globalAction: true,\n    // },\n    {\n      icon: /*#__PURE__*/React.createElement(FiUploadCloud, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 19\n        }\n      }),\n      title: 'Import Excel',\n      color: 'teal',\n      onClick: () => fileInputRef.current.click(),\n      globalAction: true\n    }, {\n      icon: /*#__PURE__*/React.createElement(FiFileText, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 19\n        }\n      }),\n      title: 'Hồ sơ',\n      color: 'blue',\n      onClick: row => {\n        window.open(`/profile/${row.personId}/medical-test`, '_blank');\n      },\n      disabled: row => row.source === SourceType.BOOKING\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    ref: fileInputRef,\n    type: \"file\",\n    hidden: true,\n    onChange: e => setSelectedFile(e.target.files[0]),\n    accept: \".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(AssignWithCodeOnlyModal, {\n    key: assignWithCodeOnlyModal ? 'OpenCreateSubjectEmergencyModal' : 'CloseCreateSubjectEmergencyModal',\n    open: assignWithCodeOnlyModal,\n    onClose: () => setAssignWithCodeOnlyModal(false),\n    onSubmit: handleAssignWithCodeOnly,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }\n  }));\n};\nexport default AnonymousAssignTable;","map":{"version":3,"names":["React","useState","useEffect","useRef","_","FiFileText","FiUploadCloud","useSelector","useDispatch","assignWithCodeOnly","getAssignees","importInformation","useAuth","showInfoModal","DataTable","SourceType","AnonymousAssignFilter","AssignWithCodeOnlyModal","columns","Header","accessor","formatter","_ref","code","length","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","row","unit","name","AnonymousAssignTable","filter","setFilter","pageIndex","setPageIndex","pageSize","setPageSize","assigneeList","cancelAssignLoading","getAssigneesLoading","assignWithCodeOnlyLoading","importInformationLoading","state","medicalTest","isAdmin","dispatch","handleRefresh","unitId","isEmpty","isUnknown","data","pageCount","assignWithCodeOnlyModal","setAssignWithCodeOnlyModal","handleAssignWithCodeOnly","d","fileInputRef","selectedFile","setSelectedFile","formData","FormData","append","then","_ref2","completed","failed","onChange","onRefresh","title","map","r","i","index","loading","onPaginationChange","p","actions","icon","color","onClick","current","click","globalAction","window","open","personId","disabled","source","BOOKING","ref","type","hidden","e","target","files","accept","key","onClose","onSubmit"],"sources":["H:/BAKCO/pj/cds/src/medical-test/components/assigns/AnonymousAssignTable.js"],"sourcesContent":["/* eslint-disable no-nested-ternary */\nimport React, { useState, useEffect, useRef } from 'react';\nimport _ from 'lodash';\nimport {\n  // FiAlertTriangle,\n  FiFileText,\n  FiUploadCloud,\n} from 'react-icons/fi';\n\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  assignWithCodeOnly,\n  getAssignees,\n  importInformation,\n} from 'medical-test/actions/medical-test';\nimport { useAuth } from 'app/hooks';\nimport { showInfoModal } from 'app/actions/global';\nimport { DataTable } from 'app/components/shared';\n\nimport { SourceType } from 'infection-chain/utils/constants';\n\nimport AnonymousAssignFilter from './AnonymousAssignFilter';\nimport AssignWithCodeOnlyModal from '../subjects/AssignWithCodeOnlyModal';\n\nconst columns = [\n  { Header: '#', accessor: 'index' },\n  {\n    Header: 'Mã xét nghiệm',\n    formatter: ({ code }) => (code?.length === 12 ? <b>{code}</b> : code),\n  },\n  { Header: 'Tên cơ sở', formatter: (row) => row.unit.name },\n];\n\nconst AnonymousAssignTable = () => {\n  const [filter, setFilter] = useState({});\n  const [pageIndex, setPageIndex] = useState(0);\n  const [pageSize, setPageSize] = useState(10);\n\n  const {\n    assigneeList,\n    cancelAssignLoading,\n    getAssigneesLoading,\n    assignWithCodeOnlyLoading,\n    importInformationLoading,\n  } = useSelector((state) => state.medicalTest);\n\n  const { isAdmin } = useAuth();\n\n  const dispatch = useDispatch();\n\n  const handleRefresh = () => {\n    if (((!isAdmin && filter.unitId) || isAdmin) && !_.isEmpty(filter)) {\n      dispatch(\n        getAssignees({\n          ...filter,\n          isUnknown: true,\n          pageIndex,\n          pageSize,\n        }),\n      );\n    }\n  };\n\n  useEffect(() => {\n    handleRefresh();\n    // eslint-disable-next-line\n  }, [filter, pageIndex, pageSize]);\n\n  const { data, pageCount } = assigneeList;\n\n  const [assignWithCodeOnlyModal, setAssignWithCodeOnlyModal] = useState(false);\n  const handleAssignWithCodeOnly = async (d) => {\n    await dispatch(assignWithCodeOnly(d));\n    handleRefresh();\n    setAssignWithCodeOnlyModal(false);\n  };\n\n  const fileInputRef = useRef();\n  const [selectedFile, setSelectedFile] = useState(null);\n  useEffect(() => {\n    if (selectedFile) {\n      const formData = new FormData();\n      formData.append('file', selectedFile);\n      dispatch(importInformation(formData)).then(({ completed, failed }) => {\n        dispatch(showInfoModal(`Thành công: ${completed}`, failed, () => {}));\n        setSelectedFile(null);\n        handleRefresh();\n      });\n    }\n    // eslint-disable-next-line\n  }, [dispatch, selectedFile]);\n\n  return (\n    <div>\n      <AnonymousAssignFilter onChange={setFilter} onRefresh={handleRefresh} />\n      <DataTable\n        title=\"Danh sách mẫu chưa xác định\"\n        columns={columns}\n        data={(data || []).map((r, i) => ({ ...r, index: i + 1 }))}\n        loading={\n          getAssigneesLoading ||\n          cancelAssignLoading ||\n          assignWithCodeOnlyLoading ||\n          importInformationLoading\n        }\n        pageCount={pageCount}\n        onPaginationChange={(p) => {\n          setPageIndex(p.pageIndex);\n          setPageSize(p.pageSize);\n        }}\n        actions={[\n          // {\n          //   icon: <FiAlertTriangle />,\n          //   title: 'Tạo khấn cấp',\n          //   color: 'orange',\n          //   onClick: () => setAssignWithCodeOnlyModal(true),\n          //   globalAction: true,\n          // },\n          {\n            icon: <FiUploadCloud />,\n            title: 'Import Excel',\n            color: 'teal',\n            onClick: () => fileInputRef.current.click(),\n            globalAction: true,\n          },\n          {\n            icon: <FiFileText />,\n            title: 'Hồ sơ',\n            color: 'blue',\n            onClick: (row) => {\n              window.open(`/profile/${row.personId}/medical-test`, '_blank');\n            },\n            disabled: (row) => row.source === SourceType.BOOKING,\n          },\n        ]}\n      />\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        hidden\n        onChange={(e) => setSelectedFile(e.target.files[0])}\n        accept=\".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel\"\n      />\n      <AssignWithCodeOnlyModal\n        key={\n          assignWithCodeOnlyModal\n            ? 'OpenCreateSubjectEmergencyModal'\n            : 'CloseCreateSubjectEmergencyModal'\n        }\n        open={assignWithCodeOnlyModal}\n        onClose={() => setAssignWithCodeOnlyModal(false)}\n        onSubmit={handleAssignWithCodeOnly}\n      />\n    </div>\n  );\n};\n\nexport default AnonymousAssignTable;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}