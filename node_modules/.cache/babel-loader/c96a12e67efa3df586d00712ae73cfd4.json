{"ast":null,"code":"var _jsxFileName = \"H:\\\\BAKCO\\\\pj\\\\data reconciliation\\\\src\\\\chain\\\\components\\\\ContactRelativeTable.js\";\n/* eslint-disable no-nested-ternary */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { FiCheck, FiFileText } from 'react-icons/fi';\nimport { Header } from 'semantic-ui-react';\nimport { useSelector } from 'react-redux';\nimport { getProfilesWithouDispatch } from 'profile/actions/profile';\nimport httpClient from 'app/utils/http-client';\nimport apiLinks from 'app/utils/api-links';\nimport { DataTable } from 'app/components/shared';\nimport { formatToYear } from 'app/utils/helpers';\nimport ContactRelativeFilter from './ContactRelativeFilter';\nconst columns = [{\n  Header: 'ID',\n  accessor: 'id'\n}, {\n  Header: 'Tên',\n  formatter: r => r.fullName,\n  cutlength: 50\n}, {\n  Header: 'Năm sinh',\n  formatter: _ref => {\n    let {\n      dateOfBirth\n    } = _ref;\n    return formatToYear(dateOfBirth);\n  }\n}, {\n  Header: 'Căn cước công dân',\n  formatter: _ref2 => {\n    let {\n      cccd\n    } = _ref2;\n    return cccd;\n  },\n  cutlength: 12\n}, {\n  Header: 'Chứng minh nhân dân',\n  formatter: _ref3 => {\n    let {\n      cmnd\n    } = _ref3;\n    return cmnd;\n  },\n  cutlength: 12\n}, {\n  Header: 'Hộ chiếu',\n  accessor: 'passportNumber'\n}, {\n  Header: 'Số bảo hiểm',\n  accessor: 'healthInsuranceNumber'\n}];\nconst ContactRelativeTable = _ref4 => {\n  let {\n    notFetchApi,\n    profileId,\n    toSubjectList,\n    onChange\n  } = _ref4;\n  const [data, setData] = useState([]);\n  const [pageCount, setPageCount] = useState(0);\n  const [fetching, setFetching] = useState(false);\n  const [pageIndex, setPageIndex] = useState(0);\n  const [pageSize, setPageSize] = useState(10);\n  const [filter, setFilter] = useState({\n    name: '',\n    isRelative: false\n  });\n  const {\n    changeProfileLoading\n  } = useSelector(state => state.medicalTest);\n  const rowActions = useMemo(() => [{\n    icon: /*#__PURE__*/React.createElement(FiCheck, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 15\n      }\n    }),\n    title: 'Chọn',\n    color: 'green',\n    onClick: r => {\n      if (notFetchApi) {\n        onChange(r);\n      } else {\n        setFetching(true);\n        httpClient.callApi({\n          url: `${apiLinks.profiles.get}/${r.id}`\n        }).then(_ref5 => {\n          let {\n            data: profile\n          } = _ref5;\n          onChange({\n            ...profile,\n            criterias: [],\n            profileId: profile === null || profile === void 0 ? void 0 : profile.id,\n            subjectToProfileId: profile === null || profile === void 0 ? void 0 : profile.id\n          });\n          setFetching(false);\n        });\n      }\n    },\n    hidden: r => toSubjectList.map(s => s.profileId).includes(r.id)\n  }, {\n    icon: /*#__PURE__*/React.createElement(FiFileText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 15\n      }\n    }),\n    title: 'Hồ sơ',\n    color: 'blue',\n    onClick: r => window.open(`/profile/${r.id}`, '_blank')\n  }], [notFetchApi, toSubjectList, onChange]);\n  useEffect(() => {\n    setFetching(true);\n    const {\n      name,\n      isRelative\n    } = filter;\n    getProfilesWithouDispatch({\n      name,\n      realtedPositiveProfileId: isRelative ? profileId : undefined,\n      pageSize,\n      pageIndex\n    }).then(_ref6 => {\n      let {\n        data: dataRes,\n        totalPages\n      } = _ref6;\n      setData(dataRes);\n      setPageCount(totalPages);\n      setFetching(false);\n    });\n  }, [profileId, filter, pageSize, pageIndex]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n    as: \"h3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }, \"Danh s\\xE1ch h\\u1ED3 s\\u01A1 trong h\\u1EC7 th\\u1ED1ng\"), /*#__PURE__*/React.createElement(ContactRelativeFilter, {\n    onChange: setFilter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(DataTable, {\n    columns: columns,\n    data: data || [],\n    loading: fetching || changeProfileLoading,\n    pageCount: pageCount,\n    onPaginationChange: p => {\n      setPageIndex(p.pageIndex);\n      setPageSize(p.pageSize);\n    },\n    actions: rowActions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }));\n};\nContactRelativeTable.propTypes = {\n  toSubjectList: PropTypes.arrayOf(PropTypes.shape()),\n  profileId: PropTypes.number,\n  onChange: PropTypes.func.isRequired,\n  notFetchApi: PropTypes.bool\n};\nContactRelativeTable.defaultProps = {\n  toSubjectList: [],\n  profileId: 0,\n  notFetchApi: false\n};\nexport default ContactRelativeTable;","map":{"version":3,"names":["React","useEffect","useMemo","useState","PropTypes","FiCheck","FiFileText","Header","useSelector","getProfilesWithouDispatch","httpClient","apiLinks","DataTable","formatToYear","ContactRelativeFilter","columns","accessor","formatter","r","fullName","cutlength","_ref","dateOfBirth","_ref2","cccd","_ref3","cmnd","ContactRelativeTable","_ref4","notFetchApi","profileId","toSubjectList","onChange","data","setData","pageCount","setPageCount","fetching","setFetching","pageIndex","setPageIndex","pageSize","setPageSize","filter","setFilter","name","isRelative","changeProfileLoading","state","medicalTest","rowActions","icon","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","title","color","onClick","callApi","url","profiles","get","id","then","_ref5","profile","criterias","subjectToProfileId","hidden","map","s","includes","window","open","realtedPositiveProfileId","undefined","_ref6","dataRes","totalPages","Fragment","as","loading","onPaginationChange","p","actions","propTypes","arrayOf","shape","number","func","isRequired","bool","defaultProps"],"sources":["H:/BAKCO/pj/data reconciliation/src/chain/components/ContactRelativeTable.js"],"sourcesContent":["/* eslint-disable no-nested-ternary */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { FiCheck, FiFileText } from 'react-icons/fi';\nimport { Header } from 'semantic-ui-react';\n\nimport { useSelector } from 'react-redux';\nimport { getProfilesWithouDispatch } from 'profile/actions/profile';\n\nimport httpClient from 'app/utils/http-client';\nimport apiLinks from 'app/utils/api-links';\nimport { DataTable } from 'app/components/shared';\nimport { formatToYear } from 'app/utils/helpers';\n\nimport ContactRelativeFilter from './ContactRelativeFilter';\n\nconst columns = [\n  { Header: 'ID', accessor: 'id' },\n  { Header: 'Tên', formatter: (r) => r.fullName, cutlength: 50 },\n  {\n    Header: 'Năm sinh',\n    formatter: ({ dateOfBirth }) => formatToYear(dateOfBirth),\n  },\n  { Header: 'Căn cước công dân', formatter: ({ cccd }) => cccd, cutlength: 12 },\n  {\n    Header: 'Chứng minh nhân dân',\n    formatter: ({ cmnd }) => cmnd,\n    cutlength: 12,\n  },\n  { Header: 'Hộ chiếu', accessor: 'passportNumber' },\n  { Header: 'Số bảo hiểm', accessor: 'healthInsuranceNumber' },\n];\n\nconst ContactRelativeTable = ({\n  notFetchApi,\n  profileId,\n  toSubjectList,\n  onChange,\n}) => {\n  const [data, setData] = useState([]);\n  const [pageCount, setPageCount] = useState(0);\n  const [fetching, setFetching] = useState(false);\n  const [pageIndex, setPageIndex] = useState(0);\n  const [pageSize, setPageSize] = useState(10);\n  const [filter, setFilter] = useState({ name: '', isRelative: false });\n\n  const { changeProfileLoading } = useSelector((state) => state.medicalTest);\n\n  const rowActions = useMemo(\n    () => [\n      {\n        icon: <FiCheck />,\n        title: 'Chọn',\n        color: 'green',\n        onClick: (r) => {\n          if (notFetchApi) {\n            onChange(r);\n          } else {\n            setFetching(true);\n            httpClient\n              .callApi({\n                url: `${apiLinks.profiles.get}/${r.id}`,\n              })\n              .then(({ data: profile }) => {\n                onChange({\n                  ...profile,\n                  criterias: [],\n                  profileId: profile?.id,\n                  subjectToProfileId: profile?.id,\n                });\n                setFetching(false);\n              });\n          }\n        },\n        hidden: (r) => toSubjectList.map((s) => s.profileId).includes(r.id),\n      },\n      {\n        icon: <FiFileText />,\n        title: 'Hồ sơ',\n        color: 'blue',\n        onClick: (r) => window.open(`/profile/${r.id}`, '_blank'),\n      },\n    ],\n    [notFetchApi, toSubjectList, onChange],\n  );\n\n  useEffect(() => {\n    setFetching(true);\n    const { name, isRelative } = filter;\n    getProfilesWithouDispatch({\n      name,\n      realtedPositiveProfileId: isRelative ? profileId : undefined,\n      pageSize,\n      pageIndex,\n    }).then(({ data: dataRes, totalPages }) => {\n      setData(dataRes);\n      setPageCount(totalPages);\n      setFetching(false);\n    });\n  }, [profileId, filter, pageSize, pageIndex]);\n  return (\n    <>\n      <Header as=\"h3\">Danh sách hồ sơ trong hệ thống</Header>\n      <ContactRelativeFilter onChange={setFilter} />\n      <DataTable\n        columns={columns}\n        data={data || []}\n        loading={fetching || changeProfileLoading}\n        pageCount={pageCount}\n        onPaginationChange={(p) => {\n          setPageIndex(p.pageIndex);\n          setPageSize(p.pageSize);\n        }}\n        actions={rowActions}\n      />\n    </>\n  );\n};\n\nContactRelativeTable.propTypes = {\n  toSubjectList: PropTypes.arrayOf(PropTypes.shape()),\n  profileId: PropTypes.number,\n  onChange: PropTypes.func.isRequired,\n  notFetchApi: PropTypes.bool,\n};\n\nContactRelativeTable.defaultProps = {\n  toSubjectList: [],\n  profileId: 0,\n  notFetchApi: false,\n};\n\nexport default ContactRelativeTable;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}